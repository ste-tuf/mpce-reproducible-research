<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-12">

<title>Hands-on Activity 2 – Master MPCE - R workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/icon-rennes.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Hands-on Activity 2 – Master MPCE - R workshop">
<meta property="og:description" content="Reproductible research and data science practices for young epidemiologist">
<meta property="og:site_name" content="Master MPCE - R workshop">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/icon-rennes.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Master MPCE - R workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-pre-workshop" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Pre-workshop</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-pre-workshop">    
        <li>
    <a class="dropdown-item" href="../content/00_pre-ws.html#software">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/00_pre-ws.html#data">
 <span class="dropdown-text">Data and script</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../content/01_intro.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/02_exercise_1.html"> 
<span class="menu-text">Hands-on Activity 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../content/03_exercise_2.html" aria-current="page"> 
<span class="menu-text">Hands-on Activity 2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ste-tuf/mpce-reproducible-research"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#goal" id="toc-goal" class="nav-link" data-scroll-target="#goal">Goal</a></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a></li>
  <li><a href="#functional-programming" id="toc-functional-programming" class="nav-link" data-scroll-target="#functional-programming">Functional Programming</a>
  <ul class="collapse">
  <li><a href="#first-use-of-map" id="toc-first-use-of-map" class="nav-link" data-scroll-target="#first-use-of-map">First use of <code>map()</code></a></li>
  <li><a href="#create-models-with-map" id="toc-create-models-with-map" class="nav-link" data-scroll-target="#create-models-with-map">Create models with <code>map()</code></a></li>
  <li><a href="#extract-models-results-with-map" id="toc-extract-models-results-with-map" class="nav-link" data-scroll-target="#extract-models-results-with-map">Extract models results with <code>map()</code></a></li>
  </ul></li>
  <li><a href="#present-the-model-results-with-a-table-using-gt" id="toc-present-the-model-results-with-a-table-using-gt" class="nav-link" data-scroll-target="#present-the-model-results-with-a-table-using-gt">Present the model results with a table using <code>gt</code></a>
  <ul class="collapse">
  <li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link" data-scroll-target="#prepare-the-data">Prepare the data</a></li>
  <li><a href="#create-the-gt-table" id="toc-create-the-gt-table" class="nav-link" data-scroll-target="#create-the-gt-table">Create the <code>gt</code> table</a></li>
  </ul></li>
  <li><a href="#generate-a-report-with-quarto" id="toc-generate-a-report-with-quarto" class="nav-link" data-scroll-target="#generate-a-report-with-quarto">Generate a report with quarto</a>
  <ul class="collapse">
  <li><a href="#report" id="toc-report" class="nav-link" data-scroll-target="#report">2007 report</a></li>
  <li><a href="#report-1" id="toc-report-1" class="nav-link" data-scroll-target="#report-1">2009 report</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ste-tuf/mpce-reproducible-research/edit/main/content/03_exercise_2.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ste-tuf/mpce-reproducible-research/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hands-on Activity 2</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<div>
<iframe class="slide-deck" src="03_slides_theory_2.html" width="100%" height="500px"></iframe>
</div>
</section>
<section id="goal" class="level1">
<h1>Goal</h1>
<p>At the end of this exercise, you should be able to produce an HTML document containing at least one table to summarize model results using <code>gt</code> and <code>quarto</code> with the <code>nh2007</code> dataset. If we have enough time, you can reproduce the analysis with the <code>nh2009</code> dataset.</p>
</section>
<section id="tasks" class="level1">
<h1>Tasks</h1>
<ul>
<li>Improve and simplify the code using functional programming</li>
<li>Create a QMD document to generate a report using Quarto</li>
<li>Make a table using <code>gt</code> to summarize model results</li>
<li>Continue to use Git to save your progress</li>
</ul>
</section>
<section id="functional-programming" class="level1">
<h1>Functional Programming</h1>
<section id="first-use-of-map" class="level2">
<h2 class="anchored" data-anchor-id="first-use-of-map">First use of <code>map()</code></h2>
<p>Let’s look at the script that we finished before the break. We created some functions that we now use for all the descriptive statistics. However, we still have to copy and paste the same line many times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbers</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>gender)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>education)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>education_child)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>asthma)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>heart_failure)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>coronary_heart_disease)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>creatinine)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>lead)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>barium)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>cadmium)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>creatinine)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>lead)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>barium)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>cadmium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Exercice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercice
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercice:</strong> Try to to use <code>map()</code>, from the <code>purrr::</code> package, to avoid copy pasting?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>map()</code> can take a data frame as its first argument <code>.x</code> and it will apply the function to each column of the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> nh2007, <span class="at">.f =</span> compute_descriptive_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will output a list which look like this:</p>
<p>If we replace the <code>.f</code> argument by another function, like <code>compute_numeric()</code> or <code>compute_descriptive_graph()</code> this will work but, only if the column is of the right type. The following will fail, as <code>mean</code> cannot be calculated for categorical variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> nh2007, <span class="at">.f =</span> compute_numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To make it work, we need to restrict to a subset of columns using <code>dplyr::select()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nh2007 <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrict to numeric variables</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">where</span>(<span class="at">fn =</span> is.numeric)) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> compute_numeric)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>nh2007 <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict to variables of interest for graphs</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(creatinine, lead, barium, cadmium) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> compute_descriptive_graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The list that <code>map()</code> return are not so easy to work with because functions are mainly build to use a dataframe. However it’s very easy to modify <code>compute_table()</code> and <code>compute_numeric()</code> to return the results in a different format.</p>
<p>When the two functions return a dataframe, it’s will be possible to use <code>dplyr::bind_rows()</code> to bind all the elements of the list from <code>map</code> into a single dataframe.</p>
<p>Let’s modify the two compute functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>compute_table <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return frequency table as a dataframe</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(variable, <span class="at">useNA =</span> <span class="st">"always"</span>, <span class="at">dnn =</span> <span class="st">"level"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>compute_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  sd_value <span class="ot">&lt;-</span> <span class="fu">sd</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return statistics as a dataframe</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"mean"</span> <span class="ot">=</span> mean_value,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sd"</span> <span class="ot">=</span> sd_value</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>(quantiles)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the function file, and source it to load the updated version of the function into our environment. Then we can try the following lines and combine <code>map()</code> results with <code>bind_rows()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> nh2007, <span class="at">.f =</span> compute_descriptive_stats) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"column"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         column        mean        sd    0%      25%   50%      75%  100% level
1            id 46562.61406 2966.3259 41477 44060.75 46513 49178.75 51622  &lt;NA&gt;
2        gender          NA        NA    NA       NA    NA       NA    NA     1
3        gender          NA        NA    NA       NA    NA       NA    NA     2
4        gender          NA        NA    NA       NA    NA       NA    NA  &lt;NA&gt;
5 age_screening    47.41593   19.2215    16    31.00    47    63.00    80  &lt;NA&gt;
  Freq
1   NA
2 1022
3 1012
4    0
5   NA</code></pre>
</div>
</div>
<p>The result is already much better and easier to work with. Notice that we didn’t had to change the <code>compute_descriptive_stats()</code> function, only the computation functions, <code>compute_table()</code> and <code>compute_numeric()</code>. This is because no calculations are happening in <code>compute_descriptive_stats()</code>, it is only calling the appropriate compute function for each type of variable.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have done some modification to our function it’s a good idea to commit the changes so you can revert to the previous version of the function if needed.</p>
<p>Jump back in Gitnuro, verify the modifications you just introduce, stage them, find a good name for the commit and press the commit button 😊</p>
</div>
</div>
</section>
<section id="create-models-with-map" class="level2">
<h2 class="anchored" data-anchor-id="create-models-with-map">Create models with <code>map()</code></h2>
<p>We can also use functional programming to simplify the creation of the models. For the 4 outcomes and the 4 exposures, the models are always the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creatinine</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span>a <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>b <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_failure <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>c <span class="ot">&lt;-</span> <span class="fu">glm</span>(coronary_heart_disease <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>d <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_attack <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>e <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007) <span class="co"># Notice that this model is identical to 1a, but it's hard to notice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create a new function! This function need to have at least 2 arugments: one argument for the outcome and another for the exposure. It’s also a good idea to add another argument to specify the dataset to use in the model. The function can look like that .</p>
<p><code>map2()</code> and <code>pmap()</code> are variant of <code>map()</code> that can iterate over two or many arguments simultaneously.</p>
<p>All the functions that we will create for the models can be saved in a new file <code>R/models.R</code>. This will help to quickly find functions based on their type when we need to modify them. Remember to add a line to source this file in the starting script.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Exercice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercice
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercise:</strong> Create a function to build the <code>glm</code> models. Use <code>map2()</code> to apply the function to all combinations of outcomes and exposures. Here as some usefull pieces of code that you can use:</p>
<p>By looking at the code, we can see that the outcomes and exposures are the following one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"asthma"</span>, <span class="st">"heart_failure"</span>, <span class="st">"coronary_heart_disease"</span>, <span class="st">"heart_attack"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>exposures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"creatinine"</span>, <span class="st">"lead"</span>, <span class="st">"barium"</span>, <span class="st">"cadmium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create a formula using <code>paste()</code> and <code>as.formula()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"asthma"</span>, <span class="st">" ~ "</span>, <span class="st">"creatinine"</span>, <span class="st">" + age_screening + gender"</span> ) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.formula</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>formula</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>asthma ~ creatinine + age_screening + gender</code></pre>
</div>
</div>
<p><code>tidyr::expand_grid()</code> creates a table from combinations of vectors. You can use it to get all the combinations of outcomes and exposures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(outcomes, exposures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   outcomes               exposures 
   &lt;chr&gt;                  &lt;chr&gt;     
 1 asthma                 creatinine
 2 asthma                 lead      
 3 asthma                 barium    
 4 asthma                 cadmium   
 5 heart_failure          creatinine
 6 heart_failure          lead      
 7 heart_failure          barium    
 8 heart_failure          cadmium   
 9 coronary_heart_disease creatinine
10 coronary_heart_disease lead      
11 coronary_heart_disease barium    
12 coronary_heart_disease cadmium   
13 heart_attack           creatinine
14 heart_attack           lead      
15 heart_attack           barium    
16 heart_attack           cadmium   </code></pre>
</div>
</div>
<p>With these three things, you can create a table containing the combination of outcomes and exposures and create a function that take every row of the table to build all the models from it.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>build_model <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome, exposure, dataset) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    outcome, <span class="st">" ~ "</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    exposure, <span class="st">" + age_screening + gender"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.formula</span>()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glm</span>(formula, <span class="at">data =</span> dataset)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># List outcomes</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"asthma"</span>, <span class="st">"heart_failure"</span>, <span class="st">"coronary_heart_disease"</span>, <span class="st">"heart_attack"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>exposures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"creatinine"</span>, <span class="st">"lead"</span>, <span class="st">"barium"</span>, <span class="st">"cadmium"</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>models_parameters <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(outcomes, exposures)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">map2</span>(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> models_parameters<span class="sc">$</span>outcomes,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> models_parameters<span class="sc">$</span>exposures,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="cf">function</span>(x, y) <span class="fu">build_model</span>(x, y, <span class="at">dataset =</span> nh2007)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>try()</code> is used to catch any errors when the models don’t run for any reason. This allows <code>map</code> to continue instead of stopping.</li>
<li><code>.f = function(x, y) build_model(x, y, dataset = nh2007)</code> is a anonymous function. It helps pass a common element to all the models. Here, it’s the dataset that we want to use for the models. Of course, this dataset can also be passed firectly by <code>pmap</code> to make the dataset vary, or written in the build model function, but it can be a little tricky.</li>
</ul>
</div>
</div>
</div>
<p>Once again, all the models are in a list. It’s easy to access a model using indexes like <code>models[[1]]</code>, but it’s a bit crude. It is possible to improve that by:</p>
<ul>
<li>Assigning names to each list element from the model parameters, so you can access models using a <code>$</code> sign.</li>
<li>Putting the models in a column in the models parameters dataframe (often a better solution).</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a big modification, take some time to move <code>build_model()</code> to the <code>R/models.R</code> file, rewrite the code in the starting script and commit the changes in Gitnuro!</p>
</div>
</div>
</section>
<section id="extract-models-results-with-map" class="level2">
<h2 class="anchored" data-anchor-id="extract-models-results-with-map">Extract models results with <code>map()</code></h2>
<p>We have seen how to use the <code>map()</code> function family to loop through columns of a dataframe and to create many models from a dataframe. Their use is not limited to that. It’s possible to extract the results of many models too.</p>
<p>In the <code>starting-script.R</code>, many line just print the <code>summary</code> of each model. A simple solution would be to replace them with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(models, summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will print the summary of all the models created at the previous steps. The inconvenient of the summary function is that it’s not easy to export as a table.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Exercice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercice
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercice:</strong> Create a function to extract estimates, CI, p-value and AIC from a model. Use <code>map</code> to apply it to every model.</p>
<p>It can be difficult to create a function from scratch, especially when working with lists. It’s sometimes easier to first work with one element of the list to test the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>test_model <span class="ot">&lt;-</span> models[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the following functions to help you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(test_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Estimate   Std. Error   t value     Pr(&gt;|t|)
(Intercept)    1.8584448409 0.0321187539 57.861673 0.0000000000
creatinine    -0.0001666218 0.0001114468 -1.495079 0.1350492277
age_screening  0.0012687634 0.0004504500  2.816658 0.0048995453
gender2       -0.0618565055 0.0171497804 -3.606840 0.0003174377</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(test_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      2.5 %        97.5 %
(Intercept)    1.7954932401  1.921396e+00
creatinine    -0.0003850536  5.180995e-05
age_screening  0.0003858977  2.151629e-03
gender2       -0.0954694575 -2.824355e-02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>test_model<span class="sc">$</span>aic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1802.235</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">confint</span>(test_model), test_model<span class="sc">$</span>aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      2.5 %        97.5 %         
(Intercept)    1.7954932401  1.921396e+00 1802.235
creatinine    -0.0003850536  5.180995e-05 1802.235
age_screening  0.0003858977  2.151629e-03 1802.235
gender2       -0.0954694575 -2.824355e-02 1802.235</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>extract_model_result <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get coefficients</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(model)) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># confidence interval</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(model) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># AIC</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> model<span class="sc">$</span>aic</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return a dataframe</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    coefs,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ci,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    aic</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get model variables in a column</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the function with one model</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_model_result</span>(test_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           term      Estimate   Std. Error   t value     Pr(&gt;|t|)         2.5 %
1   (Intercept)  1.8584448409 0.0321187539 57.861673 0.0000000000  1.7954932401
2    creatinine -0.0001666218 0.0001114468 -1.495079 0.1350492277 -0.0003850536
3 age_screening  0.0012687634 0.0004504500  2.816658 0.0048995453  0.0003858977
4       gender2 -0.0618565055 0.0171497804 -3.606840 0.0003174377 -0.0954694575
         97.5 %      aic
1  1.921396e+00 1802.235
2  5.180995e-05 1802.235
3  2.151629e-03 1802.235
4 -2.824355e-02 1802.235</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract all model results</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>models_results <span class="ot">&lt;-</span> <span class="fu">map</span>(models, extract_model_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>broom:</code> package is a very nice interface to reliably extract models results in a consistent way. The <code>tidy()</code> function can easily replace this custom-made function: https://broom.tidymodels.org/</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s time to do another commit! Move <code>extract_model_result()</code> to the <code>R/models.R</code> file, rewrite the code in the starting script and commit the changes!</p>
</div>
</div>
</section>
</section>
<section id="present-the-model-results-with-a-table-using-gt" class="level1">
<h1>Present the model results with a table using <code>gt</code></h1>
<p>In this section, we will focus on creating just one table because the <code>gt</code> package offers many options, which could be the topic of an entire workshop.</p>
<p>The <code>gt</code> package is a powerful tool for creating presentation-ready tables in R, allowing for extensive customization and styling. With gt, you can easily format numbers, add headers and footers, apply conditional formatting, and even integrate visual elements directly into your tables. Unlike manual formatting in Excel, which is time-consuming, `gt automates the process, ensuring consistency and saving time.</p>
<p>Feel free to experiment with it later if you have time, for example, to create a table for the descriptive statistics.</p>
<section id="prepare-the-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-data">Prepare the data</h2>
<p>Before creating a <code>gt</code> table, it’s best to have a clean table with only the information that we want to present. The first step is to clean the model parameters, models, and model results into one table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add models and results to the models_parameter dataframe</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> models_parameters <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> models,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">models_results =</span> models_results</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can <code>unnest()</code> the <code>models_results</code> column in the dataframe, and filter the <code>terms</code> from the model results to keep only the terms matching the <code>exposure</code> of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>results_short <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(models_results) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(exposures <span class="sc">==</span> term) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>models)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results_short)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  outcomes   exposures term  Estimate `Std. Error` `t value` `Pr(&gt;|t|)`  `2.5 %`
  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 asthma     creatini… crea… -1.67e-4    0.000111    -1.50        0.135 -3.85e-4
2 asthma     lead      lead   2.38e-3    0.00555      0.429       0.668 -8.49e-3
3 asthma     barium    bari… -3.03e-3    0.00212     -1.43        0.153 -7.18e-3
4 asthma     cadmium   cadm…  1.20e-3    0.0183       0.0654      0.948 -3.47e-2
5 heart_fai… creatini… crea… -2.77e-5    0.0000542   -0.511       0.609 -1.34e-4
6 heart_fai… lead      lead  -2.68e-3    0.00255     -1.05        0.293 -7.67e-3
# ℹ 2 more variables: `97.5 %` &lt;dbl&gt;, aic &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now the table is simpler. Let’s create a <code>gt</code> table and apply all the formating</p>
</section>
<section id="create-the-gt-table" class="level2">
<h2 class="anchored" data-anchor-id="create-the-gt-table">Create the <code>gt</code> table</h2>
<p>To create the table, follow these steps:</p>
<ol type="1">
<li>Initialize the gt table object</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> <span class="fu">gt</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> results_short,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">groupname_col =</span> <span class="st">"outcomes"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Format numbers</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> gt_table <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Estimate"</span>, <span class="st">"2.5 %"</span>, <span class="st">"97.5 %"</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"Pr(&gt;|t|)"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fns =</span> <span class="cf">function</span>(x) <span class="fu">format.pval</span>(x, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Merge and hide columns</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> gt_table <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge confidence interval values together</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_merge</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"2.5 %"</span>, <span class="st">"97.5 %"</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">"{1} - {2}"</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hide non essential columns</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_hide</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"term"</span>, <span class="st">"aic"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change column label</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"2.5 %"</span> <span class="ot">=</span> <span class="st">"95% CI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Add table title and subtitle</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> gt_table <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Models results"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"data = nh2007"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>gt_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="rxohsicnlh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rxohsicnlh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rxohsicnlh thead, #rxohsicnlh tbody, #rxohsicnlh tfoot, #rxohsicnlh tr, #rxohsicnlh td, #rxohsicnlh th {
  border-style: none;
}

#rxohsicnlh p {
  margin: 0;
  padding: 0;
}

#rxohsicnlh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rxohsicnlh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rxohsicnlh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rxohsicnlh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rxohsicnlh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rxohsicnlh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rxohsicnlh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rxohsicnlh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rxohsicnlh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rxohsicnlh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rxohsicnlh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rxohsicnlh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rxohsicnlh .gt_spanner_row {
  border-bottom-style: hidden;
}

#rxohsicnlh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rxohsicnlh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rxohsicnlh .gt_from_md > :first-child {
  margin-top: 0;
}

#rxohsicnlh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rxohsicnlh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rxohsicnlh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rxohsicnlh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rxohsicnlh .gt_row_group_first td {
  border-top-width: 2px;
}

#rxohsicnlh .gt_row_group_first th {
  border-top-width: 2px;
}

#rxohsicnlh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rxohsicnlh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rxohsicnlh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rxohsicnlh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rxohsicnlh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rxohsicnlh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rxohsicnlh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rxohsicnlh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rxohsicnlh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rxohsicnlh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rxohsicnlh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rxohsicnlh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rxohsicnlh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rxohsicnlh .gt_left {
  text-align: left;
}

#rxohsicnlh .gt_center {
  text-align: center;
}

#rxohsicnlh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rxohsicnlh .gt_font_normal {
  font-weight: normal;
}

#rxohsicnlh .gt_font_bold {
  font-weight: bold;
}

#rxohsicnlh .gt_font_italic {
  font-style: italic;
}

#rxohsicnlh .gt_super {
  font-size: 65%;
}

#rxohsicnlh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rxohsicnlh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rxohsicnlh .gt_indent_1 {
  text-indent: 5px;
}

#rxohsicnlh .gt_indent_2 {
  text-indent: 10px;
}

#rxohsicnlh .gt_indent_3 {
  text-indent: 15px;
}

#rxohsicnlh .gt_indent_4 {
  text-indent: 20px;
}

#rxohsicnlh .gt_indent_5 {
  text-indent: 25px;
}

#rxohsicnlh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rxohsicnlh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal">Models results</th>
</tr>
<tr class="odd gt_heading">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">data = nh2007</th>
</tr>
<tr class="header gt_col_headings">
<th id="exposures" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">exposures</th>
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Pr(>|t|)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Pr(&gt;|t|)</th>
<th id="a2.5-%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">95% CI</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="4" id="asthma" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">asthma</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="asthma  exposures">creatinine</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.000</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.13505</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="asthma  exposures">lead</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.002</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.66801</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.008 - 0.013</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="asthma  exposures">barium</td>
<td class="gt_row gt_right" headers="asthma  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.15283</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.007 - 0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="asthma  exposures">cadmium</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.001</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.94783</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.035 - 0.037</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="4" id="heart_failure" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">heart_failure</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="heart_failure  exposures">creatinine</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.60937</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_failure  exposures">lead</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.29314</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.008 - 0.002</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="heart_failure  exposures">barium</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.61605</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.002 - 0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_failure  exposures">cadmium</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.002</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.76814</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.014 - 0.019</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="4" id="coronary_heart_disease" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">coronary_heart_disease</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">creatinine</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.000</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.41578</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">lead</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.24778</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.008 - 0.002</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">barium</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.000</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.69466</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.002 - 0.002</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">cadmium</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.014</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.09495</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.003 - 0.031</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="4" id="heart_attack" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">heart_attack</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="heart_attack  exposures">creatinine</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.92662</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_attack  exposures">lead</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.29655</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">−0.009 - 0.003</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="heart_attack  exposures">barium</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">−0.001</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.35293</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">−0.003 - 0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_attack  exposures">cadmium</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">0.026</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.00538</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">0.008 - 0.045</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>All these steps in the gt pipeline can be grouped into one function, for example, <code>gt_models()</code>, with only a results table as an argument. This means that you can easily reapply the function to new model results and get a identical table!</p>
<p><strong>Exercice:</strong> Create this function, add it to <code>R/gt_models.R</code> and add a line to source the file in your maim script.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>gt_models <span class="ot">&lt;-</span> <span class="cf">function</span>(results_clean) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gt)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Initialize the gt table object</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> results_clean,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">groupname_col =</span> <span class="st">"outcomes"</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Format numbers</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Estimate"</span>, <span class="st">"2.5 %"</span>, <span class="st">"97.5 %"</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt</span>(</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="st">"Pr(&gt;|t|)"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">fns =</span> \(x) <span class="fu">format.pval</span>(x, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Merge and hide columns</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_merge</span>(</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"2.5 %"</span>, <span class="st">"97.5 %"</span>),</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">"{1} - {2}"</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_hide</span>(</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Std. Error"</span>, <span class="st">"t value"</span>, <span class="st">"term"</span>, <span class="st">"aic"</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(<span class="st">"2.5 %"</span> <span class="ot">=</span> <span class="st">"95% CI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Add table title and subtitle</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Models results"</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing the function</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_models</span>(results_short)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="uuanjzovci" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#uuanjzovci table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uuanjzovci thead, #uuanjzovci tbody, #uuanjzovci tfoot, #uuanjzovci tr, #uuanjzovci td, #uuanjzovci th {
  border-style: none;
}

#uuanjzovci p {
  margin: 0;
  padding: 0;
}

#uuanjzovci .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uuanjzovci .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uuanjzovci .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uuanjzovci .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uuanjzovci .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uuanjzovci .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uuanjzovci .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uuanjzovci .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uuanjzovci .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uuanjzovci .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uuanjzovci .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uuanjzovci .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uuanjzovci .gt_spanner_row {
  border-bottom-style: hidden;
}

#uuanjzovci .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uuanjzovci .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uuanjzovci .gt_from_md > :first-child {
  margin-top: 0;
}

#uuanjzovci .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uuanjzovci .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uuanjzovci .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uuanjzovci .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uuanjzovci .gt_row_group_first td {
  border-top-width: 2px;
}

#uuanjzovci .gt_row_group_first th {
  border-top-width: 2px;
}

#uuanjzovci .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uuanjzovci .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uuanjzovci .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uuanjzovci .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uuanjzovci .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uuanjzovci .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uuanjzovci .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uuanjzovci .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uuanjzovci .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uuanjzovci .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uuanjzovci .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uuanjzovci .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uuanjzovci .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uuanjzovci .gt_left {
  text-align: left;
}

#uuanjzovci .gt_center {
  text-align: center;
}

#uuanjzovci .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uuanjzovci .gt_font_normal {
  font-weight: normal;
}

#uuanjzovci .gt_font_bold {
  font-weight: bold;
}

#uuanjzovci .gt_font_italic {
  font-style: italic;
}

#uuanjzovci .gt_super {
  font-size: 65%;
}

#uuanjzovci .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uuanjzovci .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uuanjzovci .gt_indent_1 {
  text-indent: 5px;
}

#uuanjzovci .gt_indent_2 {
  text-indent: 10px;
}

#uuanjzovci .gt_indent_3 {
  text-indent: 15px;
}

#uuanjzovci .gt_indent_4 {
  text-indent: 20px;
}

#uuanjzovci .gt_indent_5 {
  text-indent: 25px;
}

#uuanjzovci .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#uuanjzovci div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border">Models results</th>
</tr>
<tr class="odd gt_col_headings">
<th id="exposures" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">exposures</th>
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Pr(>|t|)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Pr(&gt;|t|)</th>
<th id="a2.5-%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">95% CI</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="4" id="asthma" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">asthma</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="asthma  exposures">creatinine</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.000</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.13505</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="asthma  exposures">lead</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.002</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.66801</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.008 - 0.013</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="asthma  exposures">barium</td>
<td class="gt_row gt_right" headers="asthma  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.15283</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.007 - 0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="asthma  exposures">cadmium</td>
<td class="gt_row gt_right" headers="asthma  Estimate">0.001</td>
<td class="gt_row gt_right" headers="asthma  Pr(>|t|)">0.94783</td>
<td class="gt_row gt_right" headers="asthma  2.5 %">−0.035 - 0.037</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="4" id="heart_failure" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">heart_failure</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="heart_failure  exposures">creatinine</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.60937</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_failure  exposures">lead</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.29314</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.008 - 0.002</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="heart_failure  exposures">barium</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.61605</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.002 - 0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_failure  exposures">cadmium</td>
<td class="gt_row gt_right" headers="heart_failure  Estimate">0.002</td>
<td class="gt_row gt_right" headers="heart_failure  Pr(>|t|)">0.76814</td>
<td class="gt_row gt_right" headers="heart_failure  2.5 %">−0.014 - 0.019</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="4" id="coronary_heart_disease" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">coronary_heart_disease</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">creatinine</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.000</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.41578</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">lead</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.24778</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.008 - 0.002</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">barium</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.000</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.69466</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.002 - 0.002</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="coronary_heart_disease  exposures">cadmium</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Estimate">0.014</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  Pr(>|t|)">0.09495</td>
<td class="gt_row gt_right" headers="coronary_heart_disease  2.5 %">−0.003 - 0.031</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="4" id="heart_attack" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">heart_attack</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="heart_attack  exposures">creatinine</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">0.000</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.92662</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">0.000 - 0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_attack  exposures">lead</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">−0.003</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.29655</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">−0.009 - 0.003</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="heart_attack  exposures">barium</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">−0.001</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.35293</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">−0.003 - 0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="heart_attack  exposures">cadmium</td>
<td class="gt_row gt_right" headers="heart_attack  Estimate">0.026</td>
<td class="gt_row gt_right" headers="heart_attack  Pr(>|t|)">0.00538</td>
<td class="gt_row gt_right" headers="heart_attack  2.5 %">0.008 - 0.045</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Remember to commit the new changes.</p>
</div>
</div>
</div>
</section>
</section>
<section id="generate-a-report-with-quarto" class="level1">
<h1>Generate a report with quarto</h1>
<section id="report" class="level2">
<h2 class="anchored" data-anchor-id="report">2007 report</h2>
<p>Now we can put the nice table in a Quarto document to generate directly <code>HTML</code> or <code>DOCX</code> documents.</p>
<p>In RStudio create a new file: <code>qmd/report.qmd</code> In the report we should include a <code>yaml</code> header defining some execution parameters:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"NHANES Report"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Your Name"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">"date"</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span><span class="at"> html_document</span><span class="co"> # or docx</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>R code can then be executed within chunks. The first chunk should load all the packages and source all the functions:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="in"># Load packages</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="in"># Loading the functions</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="in"># here() gets the location of the project</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="in">source(here("R/descriptive.R"))</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="in">source(here("R/models.R"))</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="in">source(here("R/gt_models.R"))</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="in"># Alternative is to use .. to refer to the project root</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="in"># source("../R/descriptive.R")</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="in"># source("../R/models.R")</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="in"># source("../R/gt_models.R")</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="in"># ..  refer to the project root (one folder above the current one)</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In between each chunk, you can add text to describe what you did, or even write some method points that you need to remember for later. The syntax in this part is done in markdown.</p>
<p>The following chunks can contain all the lines that include map functions.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Excercie">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Excercie
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercise:</strong> Convert your starting script into a Quarto document.</p>
<ul>
<li>Create the file <code>qmd/report.qmd</code></li>
<li>Open it and add the yaml header and a chunck to load all the package and library.</li>
<li>Add as many chuncks as you wish for each step of the analysis.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can check the following file to see a example: <a href="../qmd/_report_example.qmd">report example</a></p>
</div>
</div>
</div>
</section>
<section id="report-1" class="level2">
<h2 class="anchored" data-anchor-id="report-1">2009 report</h2>
<p>This report is only based on the 2007 seven data. Since the 2009 data in the <code>nh2009</code> dataset is very similar, we can re-use the functions with it. It’s very easy to replicate the analysis with new dataa: it only requires applying the same functions to the new dataset.</p>
<p>Let’s create a new section in the report:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2007</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>... 2007 analysis</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># 2009</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>... 2009 analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The script for the 2009 analysis can look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">here</span>(<span class="st">"data/nh2009.RData"</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive stats</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> nh2009, <span class="at">.f =</span> compute_descriptive_stats) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"column"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List outcomes</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"asthma"</span>, <span class="st">"heart_failure"</span>, <span class="st">"coronary_heart_disease"</span>, <span class="st">"heart_attack"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>exposures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"creatinine"</span>, <span class="st">"lead"</span>, <span class="st">"barium"</span>, <span class="st">"cadmium"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>models_parameters_2009 <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(outcomes, exposures)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>models_2009 <span class="ot">&lt;-</span> <span class="fu">map2</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> models_parameters_2009<span class="sc">$</span>outcomes,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">.y =</span> models_parameters_2009<span class="sc">$</span>exposures,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> \(x, y) <span class="fu">build_model</span>(x, y, <span class="at">dataset =</span> nh2009) <span class="co"># we need to change the dataset</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model results</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>models_results_2009 <span class="ot">&lt;-</span> <span class="fu">map</span>(models_2009, extract_model_result)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>results_2009 <span class="ot">&lt;-</span> models_parameters_2009 <span class="sc">|&gt;</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> models_2009,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">models_results =</span> models_results_2009</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>results_model_clean_2009 <span class="ot">&lt;-</span> results_2009 <span class="sc">|&gt;</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(models_results) <span class="sc">|&gt;</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(exposures <span class="sc">==</span> term) <span class="sc">|&gt;</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>models)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_models</span>(results_model_clean_2009)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercice:</strong> Intergrate the following lines in the report document, and render the document (Button in RStudio toolbar).</p>
<p>Congratulation, you finished the whole workshop!</p>
<p>You can check the following files to see the final files of the project:</p>
<ul>
<li><a href="../qmd/_report_example.qmd">report_example.qmd</a> which contains the code of the report. Click on “Render” in RStudio or type <code>quarto render qmd/report_example.qmd</code> in the terminal. The rendered report can be seen here: <a href="../qmd/report_example.html">report example</a></li>
<li><a href="../R/descriptive.R">R/descriptive.R</a>, <a href="../R/models.R">R/models.R</a>, and <a href="../R/gt_models.R">R/gt_models.R</a> to see all the functions definitions</li>
</ul>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/meme_final.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ste-tuf\.github\.io\/mpce-reproducible-research\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ste-tuf/mpce-reproducible-research/edit/main/content/03_exercise_2.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ste-tuf/mpce-reproducible-research/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>© CC BY, Stephane Tuffier</p>
</div>
  </div>
</footer>




</body></html>