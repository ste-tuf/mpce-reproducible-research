<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-06-05">

<title>Hands-on Activity 1 – ISEE young 2024 - WS8 - Reproducibility</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/isee-young-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="ISEE young 2024 - WS8 - Reproducibility - Hands-on Activity 1">
<meta property="og:description" content="Reproductible research and data science practices for young epidemiologist">
<meta property="og:site_name" content="ISEE young 2024 - WS8 - Reproducibility">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/isee-young-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISEE young 2024 - WS8 - Reproducibility</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-pre-workshop" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Pre-workshop</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-pre-workshop">    
        <li>
    <a class="dropdown-item" href="../content/00_pre-ws.html#installation">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/00_pre-ws.html#data">
 <span class="dropdown-text">Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../content/01_intro.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../content/02_exercise_1.html" aria-current="page"> 
<span class="menu-text">Hands-on Activity 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/03_exercise_2.html"> 
<span class="menu-text">Hands-on Activity 2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ste-tuf/isee-young-ws-reproducibility/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#goal" id="toc-goal" class="nav-link" data-scroll-target="#goal">Goal</a></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a></li>
  <li><a href="#starting-the-project" id="toc-starting-the-project" class="nav-link" data-scroll-target="#starting-the-project">Starting the project</a>
  <ul class="collapse">
  <li><a href="#initialize-git-repository" id="toc-initialize-git-repository" class="nav-link" data-scroll-target="#initialize-git-repository">Initialize git repository</a></li>
  <li><a href="#create-a-rstudio-project" id="toc-create-a-rstudio-project" class="nav-link" data-scroll-target="#create-a-rstudio-project">Create a Rstudio project</a></li>
  <li><a href="#adding-folder-and-files" id="toc-adding-folder-and-files" class="nav-link" data-scroll-target="#adding-folder-and-files">Adding folder and files</a></li>
  <li><a href="#files-added-by-git" id="toc-files-added-by-git" class="nav-link" data-scroll-target="#files-added-by-git">Files added by git</a></li>
  </ul></li>
  <li><a href="#you-first-commit" id="toc-you-first-commit" class="nav-link" data-scroll-target="#you-first-commit">You first commit</a></li>
  <li><a href="#improve-the-script" id="toc-improve-the-script" class="nav-link" data-scroll-target="#improve-the-script">Improve the script</a>
  <ul class="collapse">
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the data</a></li>
  <li><a href="#script-style" id="toc-script-style" class="nav-link" data-scroll-target="#script-style">Script style</a></li>
  </ul></li>
  <li><a href="#create-a-function" id="toc-create-a-function" class="nav-link" data-scroll-target="#create-a-function">Create a function</a>
  <ul class="collapse">
  <li><a href="#extensions-of-the-functions" id="toc-extensions-of-the-functions" class="nav-link" data-scroll-target="#extensions-of-the-functions">Extensions of the functions</a></li>
  </ul></li>
  <li><a href="#before-break" id="toc-before-break" class="nav-link" data-scroll-target="#before-break">Before break</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ste-tuf/isee-young-ws-reproducibility/edit/main/content/02_exercise_1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ste-tuf/isee-young-ws-reproducibility/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hands-on Activity 1</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<div>
<iframe class="slide-deck" src="02_slides_theory_1.html" width="100%" height="500px"></iframe>
</div>
</section>
<section id="goal" class="level1">
<h1>Goal</h1>
<p>At the end of this exercice you should have a project folder created for the analysis. The folder should contains a git repository, th a <code>script/</code> folder containing the starting script (<code>starting_script.R</code>) and a <code>R/</code> folder containing <code>descriptive_stats.R</code> with 3 functions.</p>
</section>
<section id="tasks" class="level1">
<h1>Tasks</h1>
<ul>
<li>Setup a reproducible project for the analysis</li>
<li>Use <code>styler::</code> to improve the script</li>
<li>Make your first git commit</li>
<li>Create two simple functions for descriptive statistics</li>
</ul>
</section>
<section id="starting-the-project" class="level1">
<h1>Starting the project</h1>
<p>You should have downloaded the dataset and the script for this workshop if you followed the preworkshop instructions. If you didn’t please go check them and make sure that you already have git installed:</p>
<ul>
<li><a href="../data/nh2007.Rdata"><code>nh2007.Rdata</code></a></li>
<li><a href="../data/nh2009.Rdata"><code>nh2009.Rdata</code></a></li>
<li><a href="../R/starting_script.R"><code>starting_script.R</code></a></li>
</ul>
<div class="cal:out-info">
<p>If you wish to recreate the NHANES data by yourself, please have a look at the script in <code>data-raw/nhanes.R</code> in the workshop’s GitHub repository</p>
</div>
<p>The first step is to create a folder to gather all the files that we will create for the analysis, you can call it <code>NHANES/</code> , <code>isee-young-ws8/</code> or <code>workshop/</code> it does not matter.</p>
<p>Next we should intialize <code>git</code> within the project folder.</p>
<section id="initialize-git-repository" class="level2">
<h2 class="anchored" data-anchor-id="initialize-git-repository">Initialize git repository</h2>
<p>Navigate to the newly created folder, it should be all empty. You can right click in the folder and click on <code>Git GUI here</code>.</p>
<p><img src="..\img/git_init_win.png" class="img-fluid"></p>
<p>This will open a small widow where we can create a new git repository. The name of the workshop folder should already be there but you can add it manually if needed. You can also launch Git GUI directly from Windows start menu.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="..\img/git_gui_create.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="..\img/git_gui_create_2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Once the repository is created you should see the main Git GUI interface which look like that:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/git_gui_empty_text.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The interface is divided in several parts:</p>
<ol type="1">
<li>show the files in your working folder</li>
<li>will display modifications to file that can be staged</li>
<li>show the files in the staged area and ready to commit</li>
<li>is where you have tot entre the comit message before commiting the staged files</li>
</ol>
<p>Please note the “Rescan” button which actualise the state of the working folder in order to see any new modifications done to the files (shortcut: <code>F5</code>).</p>
<p>We can keep this windows open and we will return to it as we advance throught the workshop and need to commit modifcations.</p>
<p>Before adding things to git we need to configure you credentials. Click on <code>Edit &gt; Options</code> to open the following window:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/git_gui_edit_option.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Here you can setup your User Name and Email both for the curent proejct or for all git projects</p>
<div class="callout-info">
<p>This step can also be done using by typing the following command in the git command line namely Git Bash.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># GIT bash</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.name <span class="st">"First Last"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.email <span class="st">"first.last@example.com</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can also initialize a git repository when creating a new R Studio project.</p>
</div>
</div>
</section>
<section id="create-a-rstudio-project" class="level2">
<h2 class="anchored" data-anchor-id="create-a-rstudio-project">Create a Rstudio project</h2>
<p>Now let’s open RStudio to also initiate a Rproject. Click on “<em>New project</em>” in the project menu on the top right corner. Then select “<em>Project in existing directory</em>” and indicate the path of the workshop folder. The project should open itself.</p>
<p>Each RStudio project can be configured. You can either click on the <code>.Rproj</code> file within RStudio or click on “<em>Project option</em>” in the “<em>Tools</em>” menu.</p>
<p>It’s usally better to turn off the saving of the workspace to <code>.Rdata</code> as this prevent old data from previous computations to be loaded automatically each time you open the project which can cause a lot of issues. It’s always better to rerun the scripts form scratch.</p>
</section>
<section id="adding-folder-and-files" class="level2">
<h2 class="anchored" data-anchor-id="adding-folder-and-files">Adding folder and files</h2>
<p>Now that we have setup both Git and RStudio, let’s organise the project by creating folders and files within the project folder.</p>
<ul>
<li>Folders:
<ul>
<li><code>data/</code>: the two datasets nh2007 and nh2009 can be put here</li>
<li><code>R/</code>: keep the folder empty for now</li>
<li><code>scripts/</code>: copy starting_script.R here</li>
</ul></li>
<li>Files:
<ul>
<li><code>README.md</code>: at the root ot the project folder. You can open it in R Studio and add a very short description of the project.
<ul>
<li><code>scripts/README.md</code>, optional to add some information on the script we can find in this folder</li>
</ul></li>
<li><code>.gitignore</code>: at the root of the project folder. It can contain a list of files that git should ignore. You can open it in RStudio and add the following lines:</li>
</ul></li>
</ul>
<pre><code># History files
.Rhistory
.Rapp.history

# Session Data files
.RData
.RDataTmp

# User-specific files
.Ruserdata

# RStudio files
.Rproj.user/

# R Environment Variables
.Renviron</code></pre>
<p>This will prevent git from following the modification of these files that are only temporary and not related to the analysis.</p>
<p>The folder should look like that:</p>
</section>
<section id="files-added-by-git" class="level2">
<h2 class="anchored" data-anchor-id="files-added-by-git">Files added by git</h2>
<pre class="text"><code>Project
├── .git/ &lt;-- Git repository stored here (eg data about changes), hidden folder
├── R/
├── data/
|   ├──  nh2007.Rdata
|   └──   nh2009.Rdata
scripts/
|   ├──starting_script.R
|   └──  README.md
├── .gitignore 
├── Project.Rproj
└── README.md</code></pre>
</section>
</section>
<section id="you-first-commit" class="level1">
<h1>You first commit</h1>
<p>It’s time to save in Git the initial state of the project. Switch to the Git GUI windows.</p>
<p>Unfortunately nothing is showing up. It’s because git need to actualise the list of files in the working directory. To do so click on the “Rescan” button. Now all the files and folders should appears in the unstage part of Git Gui. Click on them to show the changes and state of each files.</p>
<p>To commit the file, we have to put them in the staged area by clicking on “<em>Stage to commit</em>” in the “<em>Commit</em>” menu (Shortcut <code>Ctr+T</code> ). Put all the files and folder in the staged area.</p>
<p>Prepare the commit by adding a commit message like: “Initial commit” or “Create project”. Then click on the commit button.</p>
<p>Congratulation all the modifications are now saved 🥳.</p>
<p>If you want to see the saved modification, you can open the repository history by clicking on “<em>View all branch history</em>” in the “<em>Repository</em>” menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/meme_commit.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="improve-the-script" class="level1">
<h1>Improve the script</h1>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>It’s time to look at the analysis script. You can try to make it run as it is.</p>
<p>The first 3 lines look like that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/folder/isee-analysis/"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nh2007 <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="st">"C:/folder/isee-analysis/nh2007.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Exercice:</strong> Can you spot the issue there? How can we improve the loading of the data within the project directory?</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Since we have setup RStudio and we are working within a project and the working directory is the project folder. Therefore we can just specify the path to load the data as a relative pathe (e.g.&nbsp;path within the project):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/nh2007.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will work on any computer with the same project sturcture. Relative paths can also used for any files, including to source R scripts.</p>
</div>
</div>
</div>
</section>
<section id="script-style" class="level2">
<h2 class="anchored" data-anchor-id="script-style">Script style</h2>
<p><strong>Question</strong>: What can you notice regarding the coding style used in the script?</p>
<ul>
<li>Is it consistent?</li>
<li>Does it match the tidyverse style guidelines?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>id<span class="ot">&lt;-</span><span class="fu">factor</span>(nh2007<span class="sc">$</span>id)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>gender<span class="ot">&lt;-</span><span class="fu">factor</span>(nh2007<span class="sc">$</span>gender)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>asthma<span class="ot">&lt;-</span> nh2007<span class="sc">$</span>asthma<span class="sc">%in%</span><span class="dv">1</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>cancer<span class="ot">&lt;-</span>nh2007<span class="sc">$</span>cancer<span class="sc">%in%</span><span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>cancer <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>cancer <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ....</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span>a <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender,<span class="at">data=</span>nh2007)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>b <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_failure <span class="sc">~</span> barium <span class="sc">+</span>age_screening<span class="sc">+</span>gender, <span class="at">data =</span> nh2007)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>c<span class="ot">&lt;-</span><span class="fu">glm</span>(coronary_heart_disease <span class="sc">~</span>barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender,<span class="at">data=</span>nh2007)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>lead2a <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma<span class="sc">~</span>lead <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can notice:</p>
<ul>
<li>Inconsistent spacing in the formulas</li>
<li>Variations in the names of the models</li>
<li>General lack of comments</li>
<li>A lot of copy pasting to repeat the same actions for many variables</li>
</ul>
</div>
</div>
</div>
<p>First, we can use <code>styler</code> to reformat the whole code:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/rstudio-styler.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The code will look much better:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">factor</span>(nh2007<span class="sc">$</span>id)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(nh2007<span class="sc">$</span>gender)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>asthma <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>asthma <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>heart_failure <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>heart_failure <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>coronary_heart_disease <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>coronary_heart_disease <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>heart_attack <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>heart_attack <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>stroke <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>stroke <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>chronic_bronchitis <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>chronic_bronchitis <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>nh2007<span class="sc">$</span>cancer <span class="ot">&lt;-</span> nh2007<span class="sc">$</span>cancer <span class="sc">%in%</span> <span class="dv">1</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ....</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span>a <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>b <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_failure <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>model.<span class="fl">1.</span>c <span class="ot">&lt;-</span> <span class="fu">glm</span>(coronary_heart_disease <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>lead2a <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> lead <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can further change the models names to make them more consitent and informative:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>model_barium_asthma <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>model_barium_hf <span class="ot">&lt;-</span> <span class="fu">glm</span>(heart_failure <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>model_barium_chd <span class="ot">&lt;-</span> <span class="fu">glm</span>(coronary_heart_disease <span class="sc">~</span> barium <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>model_lead_asthma <span class="ot">&lt;-</span> <span class="fu">glm</span>(asthma <span class="sc">~</span> lead <span class="sc">+</span> age_screening <span class="sc">+</span> gender, <span class="at">data =</span> nh2007)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This steps is actually optionnal as we will see how to avoid this in the second activity. Now the script should work and is a cleaner. Instead of saving the script as a new file we can save the modifications in git: let’s do a second comit!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/meme_commit.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>First save the script, then switch to Git Gui, click on rescan (or <code>F5</code>). Now <code>starting_script.r</code> should appear as unstaged file and you can see the modification you just made to the file on the right side. If you like the modifications, you can add the modified script to the staged area (see <a href="#you-first-commit">You first commit</a>). Add a commit message like “Apply tidyverse style guide” and commit. In the history you will see that you second commit has been added on top of the first one.</p>
<p>Notice that if you right click on the first commit you have many options like: navigate in your history, change the copy of the files you are working on, revert change, etc. This is outside of the topic of this workshop, but you can read more about it on the following page: <a href="https://git-scm.com/book/en/v2/Git-Basics-Undoing-Things" class="uri">https://git-scm.com/book/en/v2/Git-Basics-Undoing-Things</a></p>
</section>
</section>
<section id="create-a-function" class="level1">
<h1>Create a function</h1>
<p>Let’s move on the final step of this exercice. As we notice, many steps in this script are repetitives. This is probably fine for this small script, but not so much when you will have 1 000+ lines to modify.</p>
<p>Form lines 41 to 76, the script is doing some simple summary statistics, let’s create functions to simplify theses lines.</p>
<p><strong>Question</strong>: Look at the provided R code. What patterns or repetitive tasks do you notice?</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Frequency tables and bar plots for factors and logical</li>
<li>Means, standard deviations, quantiles, and histograms for numerical.</li>
</ul>
</div>
</div>
</div>
<p><strong>Exercise</strong>: Write a simple function to compute a frequency table with NA values included.</p>
<p>To find the steps that you need to put in the body of the function, you can first try to do a frequency table on one variable of the dataset. When it’s working, copy paste the steps in the function’s body and replace the variable names wiht <code>variable</code>. Before testing the function, you need to run the lines with the function definition to load the function in R memory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>compute_table <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Steps to do on variable</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>compute_table <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return frequency table as a dataframe</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(variable, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with gender variable</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_table</span>(<span class="at">variable =</span> nh2007<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>Exercise</strong>: Create a similar function for numeric variables. The function need to return the mean, standard deviation, and quantiles.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>compute_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the statistics</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  sd_value <span class="ot">&lt;-</span> <span class="fu">sd</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return statistics, in a list</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean"</span> <span class="ot">=</span> mean_value,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sd"</span> <span class="ot">=</span> sd_value,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"quantiles"</span> <span class="ot">=</span> quantiles</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, we need to return multiple results. To do so, all the results need to be regrouped in a list or a dataframe because functions can only return one object.</p>
</div>
</div>
</div>
<p><strong>Exercise</strong>: Join together the two functions in one function that can handle both categorical and numerical variables.</p>
<p>To test variable type you can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(variable)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(variable)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.logical</span>(variable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>compute_descriptive_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to call if the variable is numeric</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(variable)) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    statistics <span class="ot">&lt;-</span> <span class="fu">compute_numeric</span>(variable)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to call if the variable is a factor or a logical</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.factor</span>(variable) <span class="sc">||</span> <span class="fu">is.logical</span>(variable)) {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    statistics <span class="ot">&lt;-</span> <span class="fu">compute_table</span>(variable)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  statistics</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the function</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>age_screening)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now we can rewrite the previous lines like that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>gender)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>education)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>education_child)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>asthma)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>heart_failure)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>coronary_heart_disease)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>creatinine)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>lead)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>barium)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_stats</span>(nh2007<span class="sc">$</span>cadmium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="extensions-of-the-functions" class="level2">
<h2 class="anchored" data-anchor-id="extensions-of-the-functions">Extensions of the functions</h2>
<p>Discuss which possible extensions and modifications are possible:</p>
<ul>
<li>create plots for each type of variable using ggplot2</li>
<li>adding other statistical measures</li>
</ul>
<p><strong>Exercise</strong>: create a new function that create plots for each type of variable using ggplot2.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive univariate graphs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>compute_descriptive_graph <span class="ot">&lt;-</span> <span class="cf">function</span>(variable) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Histogram</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(variable)) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> variable)) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Barplot</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.factor</span>(variable) <span class="sc">||</span> <span class="fu">is.logical</span>(variable)) {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> variable)) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_bar</span>()</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the function</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>creatinine)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>lead)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>barium)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_descriptive_graph</span>(nh2007<span class="sc">$</span>cadmium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The little <code>p</code> is needed at the of the function to return the graph. If you remove it you will see that nothing will be return. This is because a function return the last output from it’s body.</p>
</div>
</div>
</div>
<p><strong>Optionnal exercise</strong>: create a new descriptive statistics function that includes at least one additional calculation not covered previously.</p>
</section>
</section>
<section id="before-break" class="level1">
<h1>Before break</h1>
<p>Move all the new functions to a file in the R folder “descriptive_stats.R”.</p>
<p>Add a line to source “R/descriptive_stats.R” in “starting_script.R”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/descriptive_stats.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the change in git and commit the newly created functions.</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\img/meme_break.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ste-tuf\.github\.io\/isee-young-ws-reproducibility\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ste-tuf/isee-young-ws-reproducibility/edit/main/content/02_exercise_1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ste-tuf/isee-young-ws-reproducibility/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>© CC BY-NC, Stephane Tuffier</p>
</div>
  </div>
</footer>




</body></html>